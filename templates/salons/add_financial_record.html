{% extends 'base/base.html' %}

{% block title %}Adicionar Registro Financeiro - {{ salon.name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="text-primary mb-1">
                    <i class="fas fa-plus me-2"></i>Adicionar Registro Financeiro
                </h2>
                <p class="text-muted mb-0">Nova receita ou despesa - {{ salon.name }}</p>
            </div>
            <div>
                <a href="{% url 'salons:financial_dashboard' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Voltar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <form method="post" novalidate>
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="transaction_type" class="form-label">Tipo de Transação</label>
                        <select name="transaction_type" id="transaction_type" class="form-control" required>
                            <option value="">Selecione o tipo</option>
                            <option value="income">Receita</option>
                            <option value="expense">Despesa</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="category-group">
                        <label for="category" class="form-label">Categoria</label>
                        <select name="category" id="category" class="form-control" required>
                            <option value="">Selecione uma categoria</option>
                        </select>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="amount" class="form-label">Valor (R$)</label>
                            <input type="number" name="amount" id="amount" class="form-control" step="0.01" min="0" required placeholder="0.00">
                        </div>
                        <div class="col-md-3">
                            <label for="reference_month" class="form-label">Mês</label>
                            <select name="reference_month" id="reference_month" class="form-control" required>
                                {% for i in "123456789012"|make_list %}
                                    <option value="{{ forloop.counter }}" {% if forloop.counter == default_month %}selected{% endif %}>
                                        {{ forloop.counter }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="reference_year" class="form-label">Ano</label>
                            <input type="number" name="reference_year" id="reference_year" class="form-control" value="{{ default_year }}" min="2020" max="2030" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Descrição</label>
                        <input type="text" name="description" id="description" class="form-control" maxlength="200" required placeholder="Descreva a receita ou despesa">
                    </div>
                    
                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Salvar Registro
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Dados das categorias vindos do Django
const expenseCategories = [
    {% for code, name in expense_categories %}
    ['{{ code }}', '{{ name }}'],
    {% endfor %}
];

const incomeCategories = [
    {% for code, name in income_categories %}
    ['{{ code }}', '{{ name }}'],
    {% endfor %}
];

document.getElementById('transaction_type').addEventListener('change', function() {
    const categorySelect = document.getElementById('category');
    const transactionType = this.value;
    
    // Limpar opções atuais
    categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
    
    if (transactionType === 'expense') {
        // Adicionar categorias de despesa
        expenseCategories.forEach(function(category) {
            const option = document.createElement('option');
            option.value = category[0];
            option.textContent = category[1];
            categorySelect.appendChild(option);
        });
    } else if (transactionType === 'income') {
        // Adicionar categorias de receita
        incomeCategories.forEach(function(category) {
            const option = document.createElement('option');
            option.value = category[0];
            option.textContent = category[1];
            categorySelect.appendChild(option);
        });
    }
});
</script>
{% endblock %}